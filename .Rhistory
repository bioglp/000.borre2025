stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
facet_grid(~`Interno/Esterno`)+
theme(legend.position = 'top')+
labs(x='',fill='')
p0/p1
p0 <- br %>%
ggplot(aes(Stagione,Peso.in.grammi))+
geom_boxplot(col='grey')+
stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
theme(legend.position = 'top')+
labs(x='',fill='')
p1 <- br %>%
ggplot(aes(Stagione,Peso.in.grammi,fill=`Interno/Esterno`))+
geom_boxplot()+
stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
facet_grid(~`Interno/Esterno`)+
theme(legend.position = 'top')+
labs(x='',fill='')
p0/p1
p0 <- br %>%
ggplot(aes(Stagione,Peso.in.grammi))+
geom_boxplot(fill='grey')+
stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
theme(legend.position = 'top')+
labs(x='',fill='')
p1 <- br %>%
ggplot(aes(Stagione,Peso.in.grammi,fill=`Interno/Esterno`))+
geom_boxplot()+
stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
facet_grid(~`Interno/Esterno`)+
theme(legend.position = 'top')+
labs(x='',fill='')
p0/p1
compare_means(Lunghezza.in.cm~Stagione,
data = br) %>%
gt()
p0 <- br %>%
ggplot(aes(Stagione,Lunghezza.in.cm))+
geom_boxplot(fill='grey')+
stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
theme(legend.position = 'top')+
labs(x='',fill='')
p1 <- br %>%
ggplot(aes(Stagione,Lunghezza.in.cm,fill=`Interno/Esterno`))+
geom_boxplot()+
stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
facet_grid(~`Interno/Esterno`)+
theme(legend.position = 'bottom')+
labs(x='',fill='')
p0/p1
compare_means(Larghezza.in.cm~Stagione,
data = br) %>%
gt()
p0 <- br %>%
ggplot(aes(Stagione,Larghezza.in.cm))+
geom_boxplot(fill='grey')+
stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
theme(legend.position = 'top')+
labs(x='',fill='')
p1 <- br %>%
ggplot(aes(Stagione,Larghezza.in.cm,fill=`Interno/Esterno`))+
geom_boxplot()+
stat_compare_means(
comparisons = list(
c("Primavera", "Estate"),
c("Primavera", "Autunno"),
c("Primavera", "Inverno"),
c("Estate", "Autunno"),
c("Estate", "Inverno"),
c("Autunno", "Inverno")
),
label = "p.signif"
) +
facet_grid(~`Interno/Esterno`)+
theme(legend.position = 'none')+
labs(x='',fill='')
p0/p1
# Chunk 1
dir.create('input', showWarnings = FALSE)
#dir.create('output', showWarnings = FALSE)
#dir.create('plots', showWarnings = FALSE)
dir.create('R-script', showWarnings = FALSE)
library(pacman)
p_load(tidyverse,stargazer,skimr,janitor,lubridate,here,
scales,ggpubr,rstatix,openxlsx,gt,patchwork)
theme_set(theme_bw(base_size = 14))
# -------------------------------------
# Chunk 2
# import data
# br %>%
# pivot_longer(cols=Attribuzione.1:Attribuzione.6,
#              names_to = 'SpecieAtt',
#              values_to = 'SpeciePredata' ) %>%
#   filter(!is.na(SpeciePredata))
# write.xlsx(br,'input/Borre2025.xlsx')
br <- read.xlsx(here('input/Borre2025.xlsx'), detectDates = T)
glimpse(br)
br <- br %>%
mutate(Stagione = factor(Stagione,
levels = c("Inverno",
"Primavera",
"Estate",
"Autunno")),
month=month(Data),
year=year(Data))
# Chunk 3
df.y <- br %>%
group_by(year, Stagione, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(year, Stagione,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(year, Stagione) %>%
mutate(p=n/sum(n))
df.y %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)+
labs(fill='',x='',y='')+
theme(legend.position = 'top')
# Chunk 4
#head(br)
# Livello tassonomico più alto
df.m <- br %>%
group_by(month, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(month,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(month) %>%
mutate(p=n/sum(n))
df.m %>%
ggplot(aes(as.factor(month),p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='\nMonth',y='',fill='')+
theme(legend.position = 'top')
df.g <- br %>%
group_by(Stagione, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(Stagione,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(Stagione) %>%
mutate(p=n/sum(n))
df.g %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='',y='',fill='')+
theme(legend.position = 'top')
# Livello tassonomico più basso
df.t <- br %>%
group_by(Stagione, Taxon) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon)) %>%
group_by(Stagione,Taxon) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(Stagione) %>%
mutate(p=n/sum(n))
df.t %>%
ggplot(aes(Stagione,p,fill=Taxon))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='',y='',fill='')+
theme(legend.position = 'top')
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = round(p*100,1)),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90,
vjust = 0.5,
hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'none',
axis.text.x = element_text(angle = 90,
vjust = 0.5,
hjust = 1))+
labs(size='')
p1+p2
library(ggplot2)
library(ggalluvial)
library(dplyr)
df.alluv <- df.t %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
library(ggalluvial)
df.alluv <- br %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
df.alluv
ggplot(df.alluv,
aes(axis1 = Stagione,
axis2 = Gruppo,
axis3 = Taxon,
y = p)) +
scale_x_discrete(limits = c("Stagione", "Gruppo", "Taxon"),
expand = c(.05, .05)) +
geom_alluvium(aes(fill = Gruppo), width = 1/12) +
geom_stratum(width = 1/8, fill = "grey85", color = "grey40") +
geom_text(stat = "stratum",
aes(label = after_stat(stratum))) +
labs(y = "Proporzione",
x = "",
fill = "Gruppo") +
theme_minimal() +
theme(axis.text.x = element_text(size = 12))
df.alluv <- br %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
df.alluv
ggplot(df.alluv,
aes(axis1 = Stagione,
axis2 = Gruppo,
axis3 = Taxon,
y = Prede)) +
scale_x_discrete(limits = c("Stagione", "Gruppo", "Taxon"),
expand = c(.05, .05)) +
geom_alluvium(aes(fill = Gruppo), width = 1/12) +
geom_stratum(width = 1/8,
fill = "grey85",
color = "grey40") +
geom_text(stat = "stratum",
aes(label = after_stat(stratum))) +
labs(y = "Proporzione",
x = "",
fill = "Gruppo") +
theme_minimal() +
theme(axis.text.x = element_text(size = 12))
df.alluv <- br %>%
group_by(Stagione, Taxon) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon))
df.alluv <- br %>%
group_by(Stagione, Taxon) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon)) %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
df.alluv <- br %>%
group_by(Stagione, Gruppo, Taxon) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon)) %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
df.alluv
df.alluv <- br %>%
group_by(Stagione, Gruppo, Taxon) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon)) %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
ggplot(df.alluv,
aes(axis1 = Stagione,
axis2 = Gruppo,
axis3 = Taxon,
y = Prede)) +
scale_x_discrete(limits = c("Stagione", "Gruppo", "Taxon"),
expand = c(.05, .05)) +
geom_alluvium(aes(fill = Gruppo), width = 1/12) +
geom_stratum(width = 1/8,
fill = "grey85",
color = "grey40") +
geom_text(stat = "stratum",
aes(label = after_stat(stratum))) +
labs(y = "Proporzione",
x = "",
fill = "Gruppo") +
theme_minimal() +
theme(axis.text.x = element_text(size = 12))
df.alluv
df.alluv <- br %>%
group_by(Stagione, Gruppo, Taxon) %>%
summarise(Prede = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon)) %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
ggplot(df.alluv,
aes(axis1 = Stagione,
axis2 = Gruppo,
axis3 = Taxon,
y = Prede)) +
scale_x_discrete(limits = c("Stagione", "Gruppo", "Taxon"),
expand = c(.05, .05)) +
geom_alluvium(aes(fill = Gruppo), width = 1/12) +
geom_stratum(width = 1/8,
fill = "grey85",
color = "grey40") +
geom_text(stat = "stratum",
aes(label = after_stat(stratum))) +
labs(y = "Proporzione",
x = "",
fill = "Gruppo") +
theme_minimal() +
theme(axis.text.x = element_text(size = 12))
df.alluv <- br %>%
group_by(Stagione, Gruppo, Taxon) %>%
summarise(Prede = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon)) %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
df.alluv <- br %>%
group_by(Stagione, Gruppo, Taxon) %>%
summarise(Prede = n(), .groups = "drop") %>%
mutate(Taxon = if_else(Prede < 5, "Others", Taxon)) %>%
mutate(
Stagione = factor(Stagione),
Gruppo   = factor(Gruppo),
Taxon    = factor(Taxon)
)
ggplot(df.alluv,
aes(axis1 = Stagione,
axis2 = Gruppo,
axis3 = Taxon,
y = Prede)) +
scale_x_discrete(limits = c("Stagione", "Gruppo", "Taxon"),
expand = c(.05, .05)) +
geom_alluvium(aes(fill = Gruppo), width = 1/12) +
geom_stratum(width = 1/8,
fill = "grey85",
color = "grey40") +
geom_text(stat = "stratum",
aes(label = after_stat(stratum))) +
labs(y = "Proporzione",
x = "",
fill = "Gruppo") +
theme_minimal() +
theme(axis.text.x = element_text(size = 12))
ggplot(df.alluv,
aes(axis1 = Stagione,
axis2 = Gruppo,
axis3 = Taxon,
y = Prede)) +
scale_x_discrete(limits = c("Stagione", "Gruppo", "Taxon"),
expand = c(.05, .05)) +
geom_alluvium(aes(fill = Gruppo), width = 1/12) +
geom_stratum(width = 1/8,
fill = "grey85",
color = "grey40") +
geom_text(stat = "stratum",
aes(label = after_stat(stratum))) +
labs(y = "Proporzione",
x = "",
fill = "Gruppo") +
theme_minimal() +
theme(axis.text.x = element_text(size = 12),
legend.position = 'none')
ggplot(df.alluv,
aes(axis1 = Stagione,
axis2 = Gruppo,
axis3 = Taxon,
y = Prede)) +
scale_x_discrete(limits = c("Stagione", "Gruppo", "Taxon"),
expand = c(.05, .05)) +
geom_alluvium(aes(fill = Gruppo), width = 1/12) +
geom_stratum(width = 1/8,
fill = "grey85",
color = "grey40") +
geom_text(stat = "stratum",
aes(label = after_stat(stratum)),
size=3) +
labs(y = "Proporzione",
x = "",
fill = "Gruppo") +
theme_minimal() +
theme(axis.text.x = element_text(size = 12),
legend.position = 'none')
df.alluv <- br %>%
group_by(Stagione, Gruppo, Taxon) %>%
summarise(Prede = n(), .groups = "drop") %>%
# Collassa i taxa rari
mutate(Taxon = if_else(Prede < 5, "Others", Taxon)) %>%
# Ricalcola il totale Prede dopo aver creato Others
group_by(Gruppo, Taxon) %>%
mutate(Prede_tot = sum(Prede)) %>%
ungroup() %>%
# Ordina Gruppo e Taxon per numero totale di Prede
mutate(
Gruppo = fct_reorder(Gruppo, Prede_tot, .desc = TRUE),
Taxon  = fct_reorder(Taxon,  Prede_tot, .desc = TRUE),
Stagione = factor(Stagione)
)
ggplot(df.alluv,
aes(axis1 = Stagione,
axis2 = Gruppo,
axis3 = Taxon,
y = Prede)) +
scale_x_discrete(limits = c("Stagione", "Gruppo", "Taxon"),
expand = c(.05, .05)) +
geom_alluvium(aes(fill = Gruppo), width = 1/12) +
geom_stratum(width = 1/8,
fill = "grey85",
color = "grey40") +
geom_text(stat = "stratum",
aes(label = after_stat(stratum)),
size = 3) +
labs(y = "no. Prede",
x = "",
fill = "Gruppo") +
theme_minimal() +
theme(axis.text.x = element_text(size = 12),
legend.position = 'none')

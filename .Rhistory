ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)
dir.create('input', showWarnings = FALSE)
#dir.create('output', showWarnings = FALSE)
#dir.create('plots', showWarnings = FALSE)
dir.create('R-script', showWarnings = FALSE)
library(pacman)
p_load(tidyverse,stargazer,skimr,janitor,lubridate,here,
scales,ggpubr,rstatix,openxlsx, patchwork)
theme_set(theme_bw(base_size = 14))
br <- read.xlsx(here('input/Borre2025.xlsx'), detectDates = T)
glimpse(br)
br <- br %>%
mutate(Stagione = factor(Stagione,
levels = c("Winter",
"Spring",
"Summer",
"Autumn")),
month=month(Data),
year=year(Data))
df.y <- br %>%
group_by(year, Stagione, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(year, Stagione,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(year, Stagione) %>%
mutate(p=n/sum(n))
df.y %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)
br <- read.xlsx(here('input/Borre2025.xlsx'), detectDates = T)
glimpse(br)
br <- br %>%
mutate(Season = factor(Season,
levels = c("Winter",
"Spring",
"Summer",
"Autumn")),
month=month(Data),
year=year(Data))
df.y <- br %>%
group_by(year, Season, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(year, Season,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(year, Season) %>%
mutate(p=n/sum(n))
df.y %>%
ggplot(aes(Season,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)
br <- read.xlsx(here('input/Borre2025.xlsx'), detectDates = T)
glimpse(br)
br <- br %>%
mutate(Season = factor(Season,
levels = c("Winter",
"Spring",
"Summer",
"Autumn")),
month=month(Data),
year=year(Data))
df.y <- br %>%
group_by(year, Season, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(year, Season,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(year, Season) %>%
mutate(p=n/sum(n))
br <- read.xlsx(here('input/Borre2025.xlsx'), detectDates = T)
glimpse(br)
br <- br %>%
mutate(Season = factor(Season,
levels = c("Winter",
"Spring",
"Summer",
"Autumn")),
month=month(Data),
year=year(Data))
br <- br %>%
mutate(Stagione = factor(Season,
levels = c("Winter",
"Spring",
"Summer",
"Autumn")),
month=month(Data),
year=year(Data))
br <- br %>%
mutate(Season = factor(Stagione,
levels = c("Winter",
"Spring",
"Summer",
"Autumn")),
month=month(Data),
year=year(Data))
df.y <- br %>%
group_by(year, Season, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(year, Season,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(year, Season) %>%
mutate(p=n/sum(n))
df.y %>%
ggplot(aes(Season,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)
br
br <- read.xlsx(here('input/Borre2025.xlsx'), detectDates = T)
glimpse(br)
br <- br %>%
mutate(Stagione = factor(Stagione,
levels = c("Inverno",
"Primavera",
"Estate",
"Autunno")),
month=month(Data),
year=year(Data))
br <- read.xlsx(here('input/Borre2025.xlsx'), detectDates = T)
glimpse(br)
br <- br %>%
mutate(Stagione = factor(Stagione,
levels = c("Inverno",
"Primavera",
"Estate",
"Autunno")),
month=month(Data),
year=year(Data))
## Differenze tra gli anni
```{r}
df.y <- br %>%
group_by(year, Stagione, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(year, Stagione,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(year, Stagione) %>%
mutate(p=n/sum(n))
df.y %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)
df.y %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)
df.y %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)+
labs(fill='',x='',y='')
df.y %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)+
labs(fill='',x='',y='')+
theme(legend.position = 'top')
head(br)
# Livello tassonomico pi첫 alto
df.m <- br %>%
group_by(month, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(month,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(month) %>%
mutate(p=n/sum(n))
df.m %>%
ggplot(aes(as.factor(month),p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='\nMonth',y='',fill='')+
theme(legend.position = 'top')
df.g <- br %>%
group_by(Stagione, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(Stagione,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(Stagione) %>%
mutate(p=n/sum(n))
df.g %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='',y='',fill='')+
theme(legend.position = 'top')
# Livello tassonomico pi첫 basso
df.t <- br %>%
group_by(Stagione, Taxon) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon)) %>%
group_by(Stagione,Taxon) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(Stagione) %>%
mutate(p=n/sum(n))
df.t %>%
ggplot(aes(Stagione,p,fill=Taxon))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='',y='',fill='')+
theme(legend.position = 'top')
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=n))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=n))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))
p1+p2
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))
p1+p2
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))
p1+p2
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
geom_label(aes(label = p))+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
geom_label(aes(label = p),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
geom_text(aes(label = p),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
geom_text(aes(label = p),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
df.g
View(df.g)
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
geom_text(aes(label = round(p*100,1)),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
geom_text(aes(label = p),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = round(p*100,1)),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = -0.5))+
labs(size='')
p1+p2
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = round(p*100,1)),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'none',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
# Chunk 1
dir.create('input', showWarnings = FALSE)
#dir.create('output', showWarnings = FALSE)
#dir.create('plots', showWarnings = FALSE)
dir.create('R-script', showWarnings = FALSE)
library(pacman)
p_load(tidyverse,stargazer,skimr,janitor,lubridate,here,
scales,ggpubr,rstatix,openxlsx, patchwork)
theme_set(theme_bw(base_size = 14))
# -------------------------------------
# Chunk 2
# import data
# br %>%
# pivot_longer(cols=Attribuzione.1:Attribuzione.6,
#              names_to = 'SpecieAtt',
#              values_to = 'SpeciePredata' ) %>%
#   filter(!is.na(SpeciePredata))
# write.xlsx(br,'input/Borre2025.xlsx')
br <- read.xlsx(here('input/Borre2025.xlsx'), detectDates = T)
glimpse(br)
br <- br %>%
mutate(Stagione = factor(Stagione,
levels = c("Inverno",
"Primavera",
"Estate",
"Autunno")),
month=month(Data),
year=year(Data))
# Chunk 3
df.y <- br %>%
group_by(year, Stagione, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(year, Stagione,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(year, Stagione) %>%
mutate(p=n/sum(n))
df.y %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
facet_grid(~year)+
labs(fill='',x='',y='')+
theme(legend.position = 'top')
# Chunk 4
#head(br)
# Livello tassonomico pi첫 alto
df.m <- br %>%
group_by(month, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(month,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(month) %>%
mutate(p=n/sum(n))
df.m %>%
ggplot(aes(as.factor(month),p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='\nMonth',y='',fill='')+
theme(legend.position = 'top')
df.g <- br %>%
group_by(Stagione, Gruppo) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Gruppo = if_else(n < 5, "Others", Gruppo)) %>%
group_by(Stagione,Gruppo) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(Stagione) %>%
mutate(p=n/sum(n))
df.g %>%
ggplot(aes(Stagione,p,fill=Gruppo))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='',y='',fill='')+
theme(legend.position = 'top')
# Livello tassonomico pi첫 basso
df.t <- br %>%
group_by(Stagione, Taxon) %>%
summarise(n = n(), .groups = "drop") %>%
mutate(Taxon = if_else(n < 5, "Others", Taxon)) %>%
group_by(Stagione,Taxon) %>%
summarise(n = sum(n), .groups = "drop") %>%
group_by(Stagione) %>%
mutate(p=n/sum(n))
df.t %>%
ggplot(aes(Stagione,p,fill=Taxon))+
geom_col()+
scale_y_continuous(labels = percent_format())+
labs(x='',y='',fill='')+
theme(legend.position = 'top')
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = round(p*100,1)),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = -1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'none',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = round(p*100,1)),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'none',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
p1 <- df.g %>%
ggplot(aes(Stagione,Gruppo,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = round(p*100,1)),col='white')+
theme(legend.position = 'top',
axis.text.x = element_text(angle = 90,
vjust = 0.5,
hjust = 1))+
labs(size='')
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'none',
axis.text.x = element_text(angle = 90, hjust = 1))+
labs(size='')
p1+p2
p2 <- df.t %>%
ggplot(aes(Stagione,Taxon,size=p*100))+
geom_point()+labs(x='',y='')+
#geom_text(aes(label = p),col='white')+
theme(legend.position = 'none',
axis.text.x = element_text(angle = 90,
vjust = 0.5,
hjust = 1))+
labs(size='')
p1+p2
